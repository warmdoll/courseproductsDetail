//鼠标移入到已买科目和可买科目时的弹出层
// 首先循环赋值科目data-customize=JSON.stringify({"Price": 3500,"CurrentPrice": 1580,"ProductsTitle": "[VIP套餐](一建)水利水电工程管理与实务(单科)"})
// 在科目的选择的情况下  处理比较多 代码可能较长  拆分为单js处理科目选择相关
//通知其它的选择区域，形参来自哪个group
//点击全科，取消全科选中状态
//所有选择判断的主入口
//所有选择判断的主入口
//全科未选中状态并且班次选择一个
//全科未选中状态并且班次选择一个
//全选---被选中--情况处理
//全科被选中and全是公共课
//加入购物车和立即购买的处理----(立即购买需要跳转到购物车) 
//赠品显示
//商品限售数量、可售数量、停售时间显示
//秒杀倒计时处理 ActivityStatus==0是没有秒杀活动 ==1是距离秒杀活动还有XX天 ==2距离秒杀结束还剩XX天
//此处封装选择相关所有DOM处理（变红、灰、加角标……）
var showAddHtml_Ioc = function () { function a() { } a.prototype.AddHavebuyBoxHtml = function (a) { return '\x3cdiv class\x3d"append-box"\x3e\r\n                                \x3cdiv class\x3d"up-deraction"\x3e\x3c/div\x3e\r\n                                    \x3cdiv class\x3d"add-products-detailbox"\x3e\r\n                                        \x3cdiv class\x3d"add-products-detail"\x3e\r\n                                            \x3cdiv class\x3d"products-detail-top"\x3e\r\n                                                \x3cdiv class\x3d"add-coursetitle-box"\x3e\r\n                                                    \x3ci class\x3d"add-smallfont"\x3e\u60a8\u5df2\u62a5\u540d\x3c/i\x3e \x3cspan class\x3d"add-course-title"\x3e' + this.retArrObjfn(a).ProductsTitle + '\x3c/span\x3e\r\n                                                \x3c/div\x3e\r\n                                            \x3c/div\x3e\r\n                                            \x3cdiv class\x3d"products-detail-bottom"\x3e\r\n                                                \x3cp class\x3d"tc have-buy-freestudy"\x3e' + this.hbuyfree(a) + "\x3c/p\x3e\r\n                                            \x3c/div\x3e\r\n                                        \x3c/div\x3e\r\n                                    \x3c/div\x3e\r\n                                \x3c/div\x3e" }; a.prototype.AddCanBuyBoxHtml = function (a) { var c = a.closest("[data-select-group]").attr("data-select-group"), c = Sub_Helper.getInstance().GetProductsObj(c); if (0 < c.length) { var b = a.attr("data-id"), c = c.filter(function (a) { return a.SysClassId == b }), e = c[0]; 1 == globle.g_subject_type && a.is(".select[data-type\x3d'-1']") && (e = c = JSON.parse(a.attr("data-customize2"))); var g = c && 3 == c.BuyType, h = ""; 0 < c.length && 3 == e.BuyType || g ? (h = "" == e.ProductIntro ? '\x3cdiv class\x3d"margin10 add-smallfont"\x3e\r\n                                                \x3cdiv class\x3d"left add-productsdec"\x3e\x3c/div\x3e\r\n                                          \x3c/div\x3e' : '\x3cdiv class\x3d"margin10 add-smallfont"\x3e\r\n                                                \x3ci class\x3d" left"\x3e\u5546\u54c1\u63cf\u8ff0\uff1a\x3c/i\x3e\r\n                                                \x3cdiv class\x3d"left add-productsdec"\x3e\x3cdiv class\x3d"mask-layer js-mask-layer"\x3e\x3c/div\x3e\r\n                                                \x3cdiv class\x3d"js-height-productsdec"\x3e' + e.ProductIntro + "\x3c/div\x3e\r\n                                          \x3c/div\x3e", a = '\x3cdiv class\x3d"canbuyappend-box"\x3e\r\n                            \x3cdiv class\x3d"up-deraction"\x3e\x3c/div\x3e\r\n                                        \x3cdiv class\x3d"add-products-detailbox"\x3e\r\n                                            \x3cdiv class\x3d"add-products-detail"\x3e\r\n                                                \x3cdiv class\x3d"products-detail-top"\x3e\r\n                                                    \x3cdiv class\x3d"add-coursetitle-box"\x3e\r\n                                                        \x3cspan class\x3d"add-course-title"\x3e' + e.ProductsTitle + "\x3c/span\x3e" + this.freeClassHours(e) + '\r\n                                                        \x3cdiv class\x3d"clear"\x3e\r\n                                                        \x3c/div\x3e\r\n                                                    \x3c/div\x3e\r\n                                                \x3c/div\x3e\r\n                                                \x3cdiv class\x3d"products-detail-bottom"\x3e\r\n                                                    \x3cdiv class\x3d"add-price-box margin10"\x3e\r\n                                                        \x3cspan class\x3d"font-color"\x3e\u539f\u4ef7\x3ci class\x3d"course-old-price"\x3e' + e.Price + '\x3c/i\x3e\x3c/span\x3e \x3cspan class\x3d"nowfont-color"\x3e\r\n                                                            \u73b0\u4ef7\x3ci class\x3d"course-now-price"\x3e' + e.CurrentPrice + "\x3c/i\x3e\x3c/span\x3e\r\n                                                    \x3c/div\x3e" + this.AddincreasesPrice(e) + G_Ioc.getInstance().SingleFn().productsnumdate().opreatefn(a, e) + (new Seckill).opreatefn(a, e) + G_Ioc.getInstance().SingleFn().gifts().opreatefn(a, e) + h + '\x3cdiv class\x3d"clear"\x3e\x3c/div\x3e\r\n                                                        \x3cdiv class\x3d"show-more js-show-more"\x3e\x3c/div\x3e\r\n                                                    \x3c/div\x3e\r\n                                                \x3c/div\x3e\r\n                                            \x3c/div\x3e\r\n                                        \x3c/div\x3e\r\n                                    \x3c/div\x3e\r\n                                  \x3c/div\x3e') : a = "" } else a = ""; return a }; a.prototype.heightJudgment = function (a) { var c = a.find(".js-height-productsdec").height(), b = a.find(".add-productsdec"); 150 < c && (a.find(".js-mask-layer,.js-show-more").show(), a.find(".add-productsdec").addClass("max-productsdec")); $(".js-show-more").on("click", function () { b.is(".max-productsdec") ? (a.find(".js-mask-layer").hide(), a.find(".add-productsdec").removeClass("max-productsdec")) : (a.find(".js-mask-layer").show(), a.find(".add-productsdec").addClass("max-productsdec")) }) }; a.prototype.AddincreasesPrice = function (a) { return 0 == a.IncreasedPricesTips.length || null == a.IncreasedPricesTips ? "" : ' \x3cdiv class\x3d"margin10"\x3e\r\n                                     \x3cspan class\x3d"add-time-box"\x3e' + a.IncreasedPricesTips + "\x3c/span\x3e\r\n                                  \x3c/div\x3e" }; a.prototype.freeClassHours = function (a) { var c = a.freeClassHoursId; return 0 == a.freeClassHoursId.length || null == a.freeClassHoursId ? ' \x3ca href\x3d"javascript:;" style\x3d"display:none;" class\x3d"add-freestudy rt"\x3e\u6682\u65e0\u8bd5\u542c\u8bfe\x3c/a\x3e' : '\x3ca href\x3d"http://users.wangxiao.cn/player/Index.aspx?Id\x3d' + c + '" target\x3d"_blank" class\x3d"add-freestudy rt"\x3e\u514d\u8d39\u8bd5\u5b66\x3c/a\x3e' }; a.prototype.retArrObjfn = function (a) { return a.siblings("[data-type\x3d'-1']").is(".select") ? JSON.parse(a.attr("data-customize2")) : 1 == globle.g_subject_type && a.is(".have-buy[data-type\x3d'-1']") ? JSON.parse(a.attr("data-customize2")) : JSON.parse(a.attr("data-customize1")) }; a.prototype.hbuyfree = function (a) { a = this.retArrObjfn(a); var c = a.freeClassHoursId; return 0 == a.freeClassHoursId.length || null == a.freeClassHoursId ? ' \x3ca href\x3d"javascript:;" style\x3d"background-color:#ccc;" class\x3d"add-freestudy rt"\x3e\u6682\u65e0\u8bd5\u542c\u8bfe\x3c/a\x3e' : '\x3ca href\x3d"http://users.wangxiao.cn/player/Index.aspx?Id\x3d' + c + '" target\x3d"_blank" class\x3d"add-freestudy rt"\x3e\u514d\u8d39\u8bd5\u5b66\x3c/a\x3e' }; var b; return { getInstance: function () { void 0 === b && (b = new a); return b } } } (); function ClassSelect() { } ClassSelect.prototype = { opreatefn: function (a) { var b = this, c = !0; if (a.is(".select")) { G_Ioc.getInstance().DomFn(a).removeRed(); G_Ioc.getInstance().DomFn(a).RemoveDataJson(); var d = a.closest("[data-select-group]").find("[data-event-type\x3d'subject']"); G_Ioc.getInstance().DomFn($(d)).removeNoDataGrey(); d.removeClass("no-products stop-sold have-buy") } else { G_Ioc.getInstance().DomFn(a).addRed(); G_Ioc.getInstance().DomFn(a.siblings(".select")).removeRed(); var f = a.attr("data-id") + "_" + globle.g_ExamId; if (d = JSON.parse(b.sessionGetData(f))) { if (!b.ClassNoData(d.Data, a)) return !1; b.DealDataFn(a, d) } else $.ajax({ url: "/Course/GetDetailProductsList?PackageTypeId\x3d" + a.attr("data-id") + "\x26ClassId\x3d" + globle.g_ExamId, type: "GET", async: !1, dataType: "jsonp", success: function (d) { if (!G_Ioc.getInstance().GlobalFn().isJson(d)) return alert("\u65e0\u6548\u7684JSON\u683c\u5f0f\uff0c\u8bf7\u68c0\u67e5"), !1; b.sessionSetData(f, JSON.stringify(d)); b.ClassNoData(d.Data, a) || (c = !1); b.DealDataFn(a, d) }, error: function (a) { alert(a) } }) } return c } }; ClassSelect.prototype.DealDataFn = function (a, b) { this.addValue(a, b); this.allIsPublicValue(a, b); var c = a.closest("[data-select-group]").find(".select[data-event-type\x3d'subject']:not('[data-type\x3d-1]'):first"); G_Ioc.getInstance().GlobalFn().subjectHandler(c, !0) }; ClassSelect.prototype.addValue = function (a, b) { a.closest("[data-select-group]").find("[data-event-type\x3d'subject']").each(function (a, d) { var c = $(d).attr("data-id"); if (c) if ((c = G_Ioc.getInstance().GlobalFn().filterArr(c, b.Data, 1)) && 0 < c.length) { var e = JSON.stringify(c[0]); d = $(d); d.is(".nodatagrey") && G_Ioc.getInstance().DomFn($(d)).removeNoDataGrey(); d.removeAttr("data-customize1 data-customize2"); 1 == c[0].SubjectType ? d.attr("data-customize1", e) : 2 == c[0].SubjectType && d.attr("data-customize2", e); 1 < c.length && (e = JSON.stringify(c[1]), 1 == c[1].SubjectType ? d.attr("data-customize1", e) : 2 == c[1].SubjectType && d.attr("data-customize2", e)) } else G_Ioc.getInstance().DomFn($(d)).addNoDataGrey() }) }; ClassSelect.prototype.allIsPublicValue = function (a, b) { if (1 === globle.g_subject_type) { var c = G_Ioc.getInstance().GlobalFn().filterArr("", b.Data, 2); if (1 != c.length) return !1; c = JSON.stringify(c[0]); a.closest("[data-select-group]").find("[data-event\x3d'g_select_click'][data-type\x3d-1]").attr("data-customize2", c) } }; ClassSelect.prototype.sessionGetData = function (a) { var b = ""; window.localStorage && (b = sessionStorage.getItem(a), G_Ioc.getInstance().GlobalFn().isJson(b) || (b = "")); return b }; ClassSelect.prototype.sessionSetData = function (a, b) { sessionStorage.setItem(a, b) }; ClassSelect.prototype.ClassNoData = function (a, b) { if (null == a) { var c = b.closest("[data-select-group]").find("[data-event-type\x3d'subject']"); $(c).removeClass("no-products stop-sold have-buy"); G_Ioc.getInstance().DomFn($(c)).addNoDataGrey(); G_Ioc.getInstance().GlobalFn().recoverPriceNum(); $("[data-event-type\x3d'subject']").removeAttr("data-customize2 data-customize1"); return !1 } return !0 }; function SubjectClass() { } SubjectClass.prototype = { opreatefn: function (a, b) { sub_Init.call(this, a, b) }, SelectedAllCourse: function (a, b) { sub_SelectedAllCourse.call(this, a, b) }, All_Selected_DataType1: function (a) { sub_SelectedAllCourse_Pub.call(this, a) }, CanelAllCourse: function (a) { sub_CanelAllCourse.call(this, a) }, NotAllCourseSelect: function (a, b) { 1 === a.closest("[data-select-group]").find("[data-event-type\x3d'class'].select").length ? this.SelectedOneClass(a, b) : this.SelectedNoClass(a) }, SelectedOneClass: function (a, b) { sub_NotAllCourse_OneClass.call(this, a, b) }, SelectedNoClass: function (a) { sub_NotAllCourse_NoClass.call(this, a) } }; function Notice_Select(a) { var b = [1, 2, 3], c = $("[data-select-group\x3d" + a + "]"), d = c.find(".notice_class:first").html(), f = c.find(".notice_subject:first").html(); b.removeByValue(a); b.forEach(function (a, c, b) { c = $("[data-select-group\x3d'" + a + "']"); a = c.find(".notice_class:first"); c = c.find(".notice_subject:first"); a.html(d); c.html(f) }) } function sub_CanelAllCourse(a) { var b = a.parent(); G_Ioc.getInstance().DomFn(b.find("\x3e[data-type\x3d0].grey")).removeGrey(); Sub_Helper.getInstance().ForAllPubSub.call(this, a); Sub_Helper.getInstance().ClearProNotLastState.call(this, a); a = b.find("\x3e[data-type\x3d1].select"); if (1 === a.length && (b = a.attr("data-customize1")) && (b = JSON.parse(b), Sub_Helper.getInstance().ClearProLastState.call(this, a), !Sub_Helper.getInstance().BuyTypeHandler.call(this, a, b.BuyType))) return !1 } var Sub_Helper = function () { function a() { } a.prototype.CurSelectedState = function (a) { var c = a.attr("data-customize1"); if (c) return c = JSON.parse(c), Sub_Helper.getInstance().BuyTypeHandler.call(this, a, c.BuyType) ? !0 : !1 }; a.prototype.ClearProNotLastState = function (a) { a.parent().find("\x3e[data-type\x3d1]:not('.select')").removeClass("no-products stop-sold have-buy") }; a.prototype.ClearProLastState = function (a) { a.parent().find("\x3e[data-type\x3d1].select").removeClass("no-products stop-sold have-buy") }; a.prototype.ForNotAllCourseIco = function (a) { var c = this; a = a.parent(); var b = a.find("\x3e[data-type\x3d'-1']:first"); a.find("[data-event-type\x3d'subject']:not('[data-type\x3d-1]')").each(function (a, d) { d = $(d); if (d.is(".no-products,.stop-sold,.have-buy,.nodatagrey")) if (b.is(".select") && d.is("[data-type\x3d1]")) { var e = d.attr("data-customize2"); e && (e = JSON.parse(e), Sub_Helper.getInstance().BuyTypeHandler.call(c, d, e.BuyType) && d.removeClass("no-products stop-sold have-buy nodatagrey")) } else b.is(":not('.select')") && (e = d.attr("data-customize1")) && (e = JSON.parse(e), Sub_Helper.getInstance().BuyTypeHandler.call(c, d, e.BuyType) && d.removeClass("no-products stop-sold have-buy nodatagrey")) }) }; a.prototype.ForAllPubSub = function (a, b) { b = b || !1; var c = this, d = a.parent(), g = d.find("[data-type\x3d0]"); b && (g = d.find("[data-type\x3d0].select,[data-type\x3d1].select")); g.each(function (a, b) { b = $(b); var d = b.attr("data-customize1"); d && (d = JSON.parse(d), Sub_Helper.getInstance().BuyTypeHandler.call(c, b, d.BuyType) && b.removeClass("no-products stop-sold have-buy nodatagrey")) }) }; a.prototype.GetProductsObj = function (a) { var c = []; a = $("[data-select-group\x3d" + a + "]"); var b = a.find("[data-event-type\x3d'class'].select"), e = a.find("[data-event-type\x3d'subject'].select"); if (0 < b.length && 0 < e.length) if (b = a.find("[data-event-type\x3d'subject'][data-type\x3d-1].select"), 0 < b.length) if (1 == globle.g_subject_type) { if (a = b.attr("data-customize2")) a = JSON.parse(a), 3 === a.BuyType && c.push(a) } else a = a.find("[data-event-type\x3d'subject'][data-type\x3d1].select:first"), 1 === a.length && ((a = a.attr("data-customize2")) && (a = JSON.parse(a)), 3 === a.BuyType && c.push(a)); else e.each(function (a, b) { var d = $(b).attr("data-customize1"); d && (d = JSON.parse(d), 3 === d.BuyType && c.push(d)) }); return c }; a.prototype.BuyTypeHandler = function (a, b) { var c = !1; switch (b) { case 0: G_Ioc.getInstance().DomFn(a).addHaveBuy(); break; case 1: G_Ioc.getInstance().DomFn(a).addNoProducts(); break; case 2: G_Ioc.getInstance().DomFn(a).addStopSold(); break; case 3: c = !0 } return c }; a.prototype.GoToAllCourse = function (a, b) { G_Ioc.getInstance().DomFn(a).addGrey(); G_Ioc.getInstance().DomFn(b).addRed() }; var b; return { getInstance: function () { void 0 === b && (b = new a); return b } } } (); function sub_Init(a, b) { b = b || !1; var c = a.parent().find("\x3e[data-type\x3d'-1']:first"); b ? c.is(".nodatagrey") && G_Ioc.getInstance().DomFn(c).removeNoDataGrey() : a.toggleClass("select"); b && c.is(":not('.select')") && c.removeClass("no-products stop-sold have-buy"); a.is("[data-type\x3d1]") && G_Ioc.getInstance().DomFn(a.siblings("[data-type\x3d1].select")).removeRed(); c.is(".select") ? this.SelectedAllCourse(a, b) : -1 == a.attr("data-type") ? this.CanelAllCourse(a) : this.NotAllCourseSelect(a, b) } function sub_NotAllCourse_NoClass(a) { var b = a.parent(), c = b.find("\x3e[data-type\x3d0]"), d = b.find("\x3e[data-type\x3d0].select").length, f = b.find("\x3e[data-type\x3d1].select"), b = b.find("\x3e[data-type\x3d'-1']:first"); if (1 == globle.g_subject_type) if (d === c.length && 1 != c.length) Sub_Helper.getInstance().GoToAllCourse.call(this, c, b); else { if (c = a.attr("data-customize1")) if (JSON.parse(c), !Sub_Helper.getInstance().BuyTypeHandler.call(this, a, c.BuyType)) return !1 } else d === c.length && 1 == f.length && Sub_Helper.getInstance().GoToAllCourse.call(this, c, b) } function sub_NotAllCourse_OneClass(a, b) { var c = a.parent(), d = c.find("\x3e[data-type\x3d0]"), f = c.find("\x3e[data-type\x3d0].select").length, e = c.find("\x3e[data-type\x3d1].select"), g = c.find("\x3e[data-type\x3d'-1']:first"); b && Sub_Helper.getInstance().ForNotAllCourseIco.call(this, a); if (1 == globle.g_subject_type) { if (!Sub_Helper.getInstance().CurSelectedState.call(this, a)) return !1; if (f === d.length) if (e = g.attr("data-customize2")) if (e = JSON.parse(e), Sub_Helper.getInstance().BuyTypeHandler.call(this, g, e.BuyType)) Sub_Helper.getInstance().GoToAllCourse.call(this, d, g), c.find("\x3e[data-type\x3d0]").removeClass("no-products stop-sold have-buy nodatagrey"); else return !1; else if (e = a.attr("data-customize1"), e = JSON.parse(e), !Sub_Helper.getInstance().BuyTypeHandler.call(this, a, e.BuyType)) return !1 } else if (f === d.length && 1 == e.length) if (f = e.attr("data-customize2")) { if (Sub_Helper.getInstance().GoToAllCourse.call(this, d, g), c.find("\x3e[data-type\x3d0]").removeClass("no-products stop-sold have-buy nodatagrey"), c.find("\x3e[data-type\x3d1].select").removeClass("no-products stop-sold have-buy nodatagrey"), c = JSON.parse(f), !Sub_Helper.getInstance().BuyTypeHandler.call(this, e, c.BuyType)) return !1 } else Sub_Helper.getInstance().CurSelectedState.call(this, a); else Sub_Helper.getInstance().CurSelectedState.call(this, a); b && Sub_Helper.getInstance().ForAllPubSub.call(this, a, !0) } function sub_SelectedAllCourse(a, b) { var c = a.parent(), d = c.find("\x3e[data-type\x3d'-1']:first"), f = c.find("\x3e[data-type\x3d0]"); if (1 === a.closest("[data-select-group]").find("[data-event-type\x3d'class'].select").length) if (1 == globle.g_subject_type) this.All_Selected_DataType1(a); else { b && Sub_Helper.getInstance().ForNotAllCourseIco.call(this, a); var e = c.find("\x3e[data-type\x3d'1'].select:first"); if (1 === e.length) { var g = e.attr("data-customize2"); if (g) { if (g = JSON.parse(g), Sub_Helper.getInstance().ClearProLastState.call(this, e), !Sub_Helper.getInstance().BuyTypeHandler.call(this, e, g.BuyType)) return G_Ioc.getInstance().DomFn(f).addGrey(), !1 } else { c.find("\x3e[data-type\x3d'1']").removeClass("no-products stop-sold have-buy nodatagrey"); G_Ioc.getInstance().DomFn(d).removeRed(); G_Ioc.getInstance().DomFn(f).removeGrey().addRed(); Sub_Helper.getInstance().ForAllPubSub.call(this, a); return } } } a.is(d) && Sub_Helper.getInstance().ClearProNotLastState.call(this, a); G_Ioc.getInstance().DomFn(c.find("\x3e[data-type\x3d0]")).addGrey(); c.find("\x3e[data-type\x3d0]").removeClass("no-products stop-sold have-buy nodatagrey") } function sub_SelectedAllCourse_Pub(a) { a = a.parent(); var b = a.find("\x3e[data-type\x3d'-1']:first"), c = a.find("\x3e[data-type\x3d0]"), d = this; if ($("[data-type\x3d'-1']:first").attr("data-customize2")) { var f = JSON.parse(b.attr("data-customize2")); if (Sub_Helper.getInstance().BuyTypeHandler.call(this, b, f.BuyType)) b.removeClass("no-products stop-sold have-buy"), a.find("\x3e[data-type\x3d0]").removeClass("no-products stop-sold have-buy"); else return G_Ioc.getInstance().DomFn(b).removeRed(), c.each(function (a, c) { var b = $(c).attr("data-customize1"); b && (b = JSON.parse(b), Sub_Helper.getInstance().BuyTypeHandler.call(d, $(c), b.BuyType) && G_Ioc.getInstance().DomFn($(c)).removeGrey().addRed()) }), !1 } } function AddCart() { this.opreatefn = function (a) { var b = Sub_Helper.getInstance().GetProductsObj(1), c = ""; 1 == globle.g_productsflag ? c = globle.g_productsid : b.forEach(function (a, b, e) { c = "" == c ? c + a.ProductsId : c + "," + a.ProductsId }); "" == c ? a.is("#first-addCart") || a.is(".buy#first-nowapply") || a.is(".js-add-freestudy") ? this.promptSelected(a) : (a.is("#second-addCart") || a.is(".buy#second-nowapply")) && this.selectedBox(a) : this.addCartFn(c, a); this.clickFn() }; this.selectedBox = function (a) { G_Ioc.getInstance().GlobalFn().noticeSelect(1); a.is("#second-addCart") ? ($(".js-addcart-reselected,.add-selectedcourse").show(), G_Ioc.getInstance().GlobalFn().noticeSelect(3)) : a.is(".buy#second-nowapply") && ($(".js-buy-reselected,.add-selectedcourse").show(), G_Ioc.getInstance().GlobalFn().noticeSelect(2)) }; this.promptSelected = function (a) { a = a.parents(".selected-siblings").siblings(".js-findsibling"); var b = a.find(".selected-class-btn.select").length, c; c = a.find(".selected-course-btn.select:not('.have-buy,.stop-sold,.no-products,.grey')").length; 0 == b ? (G_Ioc.getInstance().DomFn().AddpromptText("\u8bf7\u9009\u62e9\u73ed\u578b"), console.log("aa")) : 1 == c && a.find(".selected-course-btn[data-type\x3d'-1']").is(".select") ? G_Ioc.getInstance().DomFn().AddpromptText("\u8bf7\u9009\u62e9\u4e13\u4e1a\u8bfe") : G_Ioc.getInstance().DomFn().AddpromptText("\u8bf7\u9009\u62e9\u79d1\u76ee") }; this.addCartFn = function (a, b) { var c = this; $.getJSON("http://k.wangxiao.cn/Course/ProductsCarts?productsId\x3d" + a + "\x26flag\x3d1\x26callback\x3d?", function (a) { if (0 == a.ResultCode) { var d = 3 == b.parents(".js-buy-reselected").find(".js-findsibling").attr("data-select-group"); if (-1 == a.Data.dealStatus) { b.is("#first-addCart") && c.productsFly(); setTimeout(function () { c.AddCompleteFn() }, 1E3); if (b.is(".buy#first-nowapply") || b.is(".buy#second-nowapply") || d) window.location.href = "http://order.wangxiao.cn/cart.aspx?url\x3d" + encodeURIComponent(window.location.href); $("#ShowCartCount").html(a.Data.Count) } else if (1 == a.Data.dealStatus) { c.AlreadyExistFn(); $(".img-append").remove(); if (b.is(".buy#first-nowapply") || b.is(".buy#second-nowapply") || d) window.location.href = "http://order.wangxiao.cn/cart.aspx?url\x3d" + encodeURIComponent(window.location.href); $("#ShowCartCount").html(a.Data.Count) } } }) }; this.baomingFn = function (a) { $.getJSON("http://wap.wangxiao.cn/course/buyproducts?productsid\x3d" + $(a).data("id") + "\x26callback\x3d?", function (a) { a && ("0" == a.ResultCode ? (G_Ioc.getInstance().DomFn().AddpromptText("\u62a5\u540d\u6210\u529f\uff01"), window.location.reload()) : a.IsLogin ? G_Ioc.getInstance().DomFn().AddpromptText("\u62a5\u540d\u5931\u8d25") : $(".top_login_btn_1:first").trigger("click")) }) }; this.productsFly = function () { if (1 == $(".shoppingcart").length) { var a, b = $(".shoppingcart").offset(), c; 1 == $(".big_pic").length ? (c = $(".big_pic img").attr("src"), a = $(".big_pic img").offset(), $("body").append("\x3cimg class\x3d'img-append' style\x3d'width:502px;height:285px;top: " + a.top + "px;left:" + a.left + "px;position:absolute;'src\x3d" + c + " /\x3e")) : 1 < $(".asdlkfjsad").length && (a = topDiv.find(".asdlkfjsad img").offset(), c = topDiv.find(".asdlkfjsad img").attr("src"), $("body").append("\x3cimg class\x3d'img-append' style\x3d'top: " + a.top + "px;left:" + a.left + "px;position:absolute;' src\x3d" + c + " /\x3e")); $(".img-append").stop(!0, !0).animate({ top: b.top - 30 + "px", left: b.left + 80 + "px", width: "0%", height: "0%" }, 1E3) } }; this.AddCompleteFn = function () { 0 < $(".js-remove").length && $(".js-remove").remove(); $("body").append($('\x3cdiv class\x3d"shadow js-remove"\x3e\r\n\t\t\t\x3cdiv class\x3d"buynow_box"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"close_window"\x3e\r\n\t\t\t\tX\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3cp class\x3d"buynow_box_tip"\x3e\u6e29\u99a8\u63d0\u793a\x3c/p\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dialog-content"\x3e\r\n\t\t\t\t\t\x3cp\x3e\u5df2\u6210\u529f\u52a0\u5165\u8d2d\u7269\u8f66\x3c/p\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dialog-console"\x3e\r\n\t\t\t\t\t\x3ca href\x3d"javascript:void(0)" id\x3d"goFinishMoney" class\x3d"console-btn-confirm"\x3e\u53bb\u7ed3\u7b97\x3c/a\x3e\r\n\t\t\t\t\t\x3ca href\x3d"javascript:void(0)" id\x3d"continueBuy" class\x3d"console-btn-cancel"\x3e\u7ee7\u7eed\u8d2d\u7269\x3c/a\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e')); $(".js-remove").show(); $(".img-append").remove() }; this.AlreadyExistFn = function () { 0 < $(".js-haveshadow").length && $(".js-haveshadow").remove(); $("body").append($('\x3cdiv class\x3d"shadow js-haveshadow"\x3e\r\n\t\t\t\x3cdiv class\x3d"nobuy_box"\x3e\r\n            \x3cdiv class\x3d"close_window"\x3e\r\n\t\t\t\tX\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3cP class\x3d"nobuy_box_text"\x3e\u8d2d\u7269\u8f66\u5df2\u7ecf\u5305\u542b\u6b64\u8bfe\u7a0b\uff0c\u4e0d\u80fd\u91cd\u590d\u6dfb\u52a0\x3c/P\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e')); $(".js-haveshadow").show() }; this.clickFn = function () { $(document).on("click", "#goFinishMoney", function () { window.open("http://order.wangxiao.cn/cart.aspx?url\x3d" + encodeURIComponent(window.location.href)); $(".shadow").hide() }).on("click", "#continueBuy", function () { $(".shadow").hide() }).on("click", ".close-sallbox", function () { $(".shadow-sall").hide() }).on("click", ".shadow", function () { G_Ioc.getInstance().DomFn($(this)).ClickShadow(); $(this).is(".js-addcart-reselected") ? G_Ioc.getInstance().GlobalFn().noticeSelect(2) : $(this).is(".js-buy-reselected") && G_Ioc.getInstance().GlobalFn().noticeSelect(3) }).on("click", ".buynow_box,.nobuy_box", function (a) { a.stopPropagation() }) } } function Gifts() { this.opreatefn = function (a, b) { var c = b.Gifts, d = ""; if (c) { for (var f = 0; f < c.length; f++) d += '\x3cp class\x3d"give-products"\x3e\r\n                                  \x3ca href\x3d"' + GetGiftUrl(c[f]) + '" class\x3d"products-name" target\x3d"_blank"\x3e' + c[f].Title + '\x3c/a\x3e\r\n                                  \x3ci class\x3d"add-end-time"\x3eX1\x3c/i\x3e\r\n                                \x3c/p\x3e'; return '\x3cdiv class\x3d"margin10 js-gifts-box"\x3e\r\n                            \x3ci class\x3d"add-smallfont left"\x3e\u8d60\uff1a\x3c/i\x3e\r\n                            \x3cdiv class\x3d"left js-gifts"\x3e' + d + ' \r\n                            \x3c/div\x3e\r\n                           \x3cdiv class\x3d"clear"\x3e\x3c/div\x3e\r\n                       \x3c/div\x3e' } return "" } } function GetGiftUrl(a) { switch (a.ProductsType) { case 6: a = "http://k.wangxiao.cn/item/" + a.Num + ".html"; break; case 3: a = "http://book.wangxiao.cn/Info/" + a.Num + ".html"; break; case 5: a = "http://book.wangxiao.cn/Info2/" + a.Num + ".html"; break; case 9: a = "http://wap.wangxiao.cn/ZhangJieKe/Index/?ClassHoursId\x3d" + a.Id + "\x26subjectId\x3d" + a.SysClassId; break; case 8: a = "http://live.wangxiao.cn/LiveCourse/?Id\x3d" + a.Id + "\x26sysClassId\x3d" + a.SysClassId; break; default: a = "javascript:void(0);" } return a } function Listen() { this.opreatefn = function () { } } function PriceNum() { this.opreatefn = function (a) { var b = $("#cur-price"), c = $("#buy-number"); a = Sub_Helper.getInstance().GetProductsObj(a); if (1 > a.length) G_Ioc.getInstance().GlobalFn().recoverPriceNum(); else if (1 === a.length) a = a[0], b.html(1 === a.ActivityStatus || 2 === a.ActivityStatus ? a.ActivityPrice : a.CurrentPrice), c.html(a.pBuy); else { for (var d = 0, f = 0, e = 0, g = a.length; e < g; e++) var h = a[e], d = d + (1 === h.ActivityStatus || 2 === h.ActivityStatus ? h.ActivityPrice : h.CurrentPrice), f = f + h.pBuy; b.html(d); c.html(f) } } } function productsNumDate() { this.opreatefn = function (a, b) { var c = b.StopSaleDate, d = b.LimitSaleCount, f = b.CanSaleCount; if (0 == b.ActivityStatus) return d = 0 < d ? '\x3cspan class\x3d"limit-html"\x3e\u9650\u552e\r\n                                    \x3cem class\x3d"limit-number"\x3e' + d + '\x3c/em\x3e\u5e2d\r\n                                     \u5269\u4f59\x3cem class\x3d"remain-number"\x3e' + f + "\x3c/em\x3e\u5e2d\x3c/span\x3e" : "", c ? (f = '\x3ci class\x3d"rt"\x3e' + this.getDate(c) + "\x3c/i\x3e", "" == d && (f = "\x3ci\x3e" + this.getDate(c) + "\x3c/i\x3e")) : f = "", '\x3cp class\x3d"margin10 js-commodity-number font-color"\x3e' + d + f + "\x3c/p\x3e" }; this.getDate = function (a) { a = new Date(a); var b = a.getFullYear(), c = a.getMonth() + 1, d = a.getDate(); a.getHours(); a.getMinutes(); a.getSeconds(); return b + "\u5e74" + this.addNum(c) + "\u6708" + this.addNum(d) + "\u65e5 " }; this.addNum = function (a) { 10 > parseInt(a) && (a = "0" + a); return a } } function Seckill() { this.seckillText = ""; this.secondTime = this.minuteTime = this.hourTime = 0; this.IntervalId = -1; this.opreatefn = function (a, b) { var c = b.ActivityStopTime, d = b.ActivityStartTime; if (0 == b.ActivityStatus) return ""; if (1 == b.ActivityStatus || 2 == b.ActivityStatus) this.DealCountDown(d, c); else if (3 == b.ActivityStatus) return '\x3cdiv class\x3d"margin10 "\x3e\r\n                               \x3cspan class\x3d"add-end-time"\x3e\u6d3b\u52a8\u5df2\u7ed3\u675f\x3c/span\x3e\r\n                          \x3c/div\x3e'; return '\x3cdiv class\x3d"margin10 "\x3e\r\n                               \x3cspan class\x3d"add-end-time js-add-end-time' + this.IntervalId + '"\x3e\x3cem  id\x3d"seckill-text-' + this.IntervalId + '"\x3e' + this.seckillText + '\x3c/em\x3e:\r\n                                    \x3cem class\x3d"end-time-box" id\x3d"seckill-hourse-' + this.IntervalId + '"\x3e' + this.hourTime + '\x3c/em\x3e:\r\n                                    \x3cem class\x3d"end-time-box" id\x3d"seckill-minute-' + this.IntervalId + '"\x3e' + this.minuteTime + '\x3c/em\x3e:\r\n                                    \x3cem class\x3d"end-time-box" id\x3d"seckill-second-' + this.IntervalId + '"\x3e' + this.secondTime + "\x3c/em\x3e\r\n                                \x3c/span\x3e\r\n                          \x3c/div\x3e" }; this.DealCountDown = function (a, b) { var c = this; c.IntervalId = setInterval(function () { c.ShowCountDown(a, b) }, 1E3) }; this.ShowCountDown = function (a, b) { var c = (new Date).getTime(), d = b - c; a >= c ? (this.hourms(d), $("#seckill-text-" + this.IntervalId).text("\u79d2\u6740\u8ddd\u79bb\u5f00\u59cb")) : a < c && c <= b && (this.hourms(d), $("#seckill-text-" + this.IntervalId).text("\u79d2\u6740\u8ddd\u79bb\u7ed3\u675f")); $("#seckill-hourse-" + this.IntervalId).html(this.hourTime); $("#seckill-minute-" + this.IntervalId).html(this.minuteTime); $("#seckill-second-" + this.IntervalId).html(this.secondTime) }; this.hourms = function (a) { 36E5 <= a && (this.hourTime = 0 == parseInt(a / 36E5) ? 0 : parseInt(a / 36E5), a %= 36E5); 6E4 <= a && (this.minuteTime = 0 == parseInt(a / 6E4) ? 0 : parseInt(a / 6E4), a %= 6E4); this.secondTime = 0 == parseInt(a / 1E3) ? 0 : parseInt(a / 1E3) } } function Tree() { this.opreatefn = function () { console.log("\u4ef7\u683c") } } function Dom_Select(a) { this.o = $(a) } Dom_Select.prototype = { addRed: function () { this.o.addClass("select"); return this }, addGrey: function () { this.o.addClass("grey"); return this }, addNoDataGrey: function () { this.o.addClass("nodatagrey"); return this }, removeNoDataGrey: function () { this.o.removeClass("nodatagrey"); return this }, removeRed: function () { this.o.removeClass("select") }, removeGrey: function () { this.o.removeClass("grey"); return this }, addHaveBuy: function () { this.o.addClass("have-buy"); return this }, removeHaveBuy: function () { this.o.removeClass("have-buy"); return this }, addNoProducts: function () { this.o.addClass("no-products") }, removeNoProducts: function () { this.o.removeClass("no-products"); return this }, addStopSold: function () { this.o.addClass("stop-sold"); return this }, removeStopSold: function () { this.o.removeClass("stop-sold"); return this }, RemoveDataJson: function () { $("[data-event\x3d'g_select_click'][data-event-type\x3d'subject']").each(function (a, b) { $(b).removeAttr("data-customize2 data-customize1") }) }, AddHavebuyBox: function () { var a = showAddHtml_Ioc.getInstance().AddHavebuyBoxHtml(this.o); this.o.find(".jsadddetail-html").html(a) }, AddCanBuyBox: function () { var a = showAddHtml_Ioc.getInstance().AddCanBuyBoxHtml(this.o); 0 < this.o.parents(".selected-products-box").find(".select[data-event-type\x3d'class']").length ? (this.o.find(".jsadddetail-html").html(a), showAddHtml_Ioc.getInstance().heightJudgment(this.o)) : this.o.find(".jsadddetail-html").html("") }, AddpromptText: function (a) { $(".js-small-box").show(); $("#message-text").html(a) }, ClickShadow: function () { this.o.hide() }, CloseWindow: function () { $(".shadow").hide() } }; var G_Ioc = function () { function a() { } a.prototype.SingleFn = function () { return new SingleModule }; a.prototype.GlobalFn = function () { return new GlobalModule }; a.prototype.DomFn = function (a) { return new Dom_Select(a) }; var b; return { getInstance: function () { void 0 === b && (b = new a); return b } } } (); function GlobalModule() { } GlobalModule.prototype = { init: function () { 2 == globle.g_subject_type && $("[data-select-group\x3d1]").find("[data-type\x3d1]").after('\x3cdiv data-event\x3d"g_select_click" data-event-type\x3d"subject" data-type\x3d"0" class\x3d"selected-course-btn selected-btnstyle statusafter" data-id\x3d"" style\x3d"display:none"\x3etemp\x3c/div\x3e'); var a = this, b; $("[data-select-group]").on("click", "[data-event\x3d'g_select_click']", function (c) { c = $(this); var d = c.attr("data-event-type"); b = !0; if (c.is(".grey")) G_Ioc.getInstance().DomFn().AddpromptText("\u5168\u79d1\u5df2\u7ecf\u5305\u542b\u6b64\u516c\u5171\u8bfe"); else if (!c.is(".nodatagrey,.have-buy,.no-products,.stop-sold")) { switch (d) { case "class": a.classHandler(c) || (b = !1); break; case "subject": a.subjectHandler(c) } b && (c = c.closest("[data-select-group]").attr("data-select-group"), G_Ioc.getInstance().SingleFn().price_num().opreatefn(c)) } }); $("[data-select-group]").on("mouseover", "[data-event\x3d'g_select_click'] .jsadd-html", function () { var a = $(this).parents("[data-event\x3d'g_select_click']"); b ? 1 == globle.g_subject_type && a.is(".select[data-type\x3d'-1']") ? a.is(".select.selected-course-btn[data-type\x3d'-1']") && !a.is(".select.have-buy") && G_Ioc.getInstance().DomFn(a).AddCanBuyBox() : a.is(".select.selected-course-btn") && !a.is(".select.have-buy,.nodatagrey") && G_Ioc.getInstance().DomFn(a).AddCanBuyBox() : G_Ioc.getInstance().DomFn(a).AddCanBuyBox(); a.is(".have-buy[data-event-type\x3d'subject']") && G_Ioc.getInstance().DomFn(a).AddHavebuyBox() }); $(".add-products-detail").on("click", function (a) { a.stopPropagation() }); this.dom_init(); showAddHtml_Ioc.getInstance().heightJudgment($(".js-confirm-products")) }, classHandler: function (a) { return (new ClassSelect).opreatefn(a) }, subjectHandler: function (a, b) { (new SubjectClass).opreatefn(a, b); a.find(".jsadddetail-html").html("") }, noticeSelect: function (a) { Notice_Select.call(this, a) }, filterArr: function (a, b, c) { return !b || 1 > b.length ? [] : b.filter(function (b) { if (1 == c) return b.SysClassId == a; if (2 == c) return 2 == b.SubjectType }) }, isJson: function (a) { try { return JSON.stringify(a), !0 } catch (b) { return !1 } }, recoverPriceNum: function () { $("#cur-price").html(window.cur_price_html); $("#buy-number").html(window.cur_buy_num) }, dom_init: function () { switch (globle.g_productsflag) { case 2: $("[data-select-group\x3d1]").find("[data-event-type\x3d'class']:first").trigger("click"); break; case 3: G_Ioc.getInstance().DomFn($("[data-select-group\x3d1]").find("[data-event-type\x3d'subject'][data-type!\x3d'-1']:first")).addRed() } window.cur_price_html = $("#cur-price").html(); window.cur_buy_num = $("#buy-number").html(); var a; $.getJSON("http://users.wangxiao.cn/Passport/GetLoginInfo.ashx?callback\x3d?", function (b) { a = null != b ? b.Username2 : " "; sessionStorage.getItem("userNameFlag") ? sessionStorage.getItem("userNameFlag") != a && (sessionStorage.clear(), 2 == globle.g_productsflag && ($("[data-select-group\x3d1]").find("[data-event-type\x3d'class']:first").removeClass("select"), $("[data-select-group\x3d1]").find("[data-event-type\x3d'class']:first").trigger("click")), sessionStorage.setItem("userNameFlag", a)) : sessionStorage.setItem("userNameFlag", a) }); $(document).on("click", ".close_window", function () { $(this).parents(".shadow").hide() }).on("click", ".shadow,.buynow_box,.nobuy_box", function (a) { a.stopPropagation() }); $(".jsadddetail-html").on("click", function (a) { a.stopPropagation() }); $(".js-addcart-reselected .close_classwindow").click(function (a) { $(".shadow,.add-selectedcourse,.js-small-box").hide(); G_Ioc.getInstance().GlobalFn().noticeSelect(2) }); $(".js-buy-reselected .close_classwindow").click(function (a) { $(".shadow,.add-selectedcourse,.js-small-box").hide(); G_Ioc.getInstance().GlobalFn().noticeSelect(3) }); $(".js-add-freestudy").on("click", function () { var a = $(this); 1 == $(this).parents(".js-addcart-reselected").length ? (G_Ioc.getInstance().GlobalFn().noticeSelect(2), G_Ioc.getInstance().SingleFn().addCart().opreatefn(a)) : 1 == $(this).parents(".js-buy-reselected").length && (G_Ioc.getInstance().GlobalFn().noticeSelect(3), G_Ioc.getInstance().SingleFn().addCart().opreatefn(a)) }); $(".now_buy.addCart,.buy#first-nowapply,.buy#second-nowapply").on("click", function () { var a = $(this); G_Ioc.getInstance().SingleFn().addCart().opreatefn(a) }); $(".baoming").on("click", function () { G_Ioc.getInstance().SingleFn().addCart().baomingFn($(this)) }); Array.prototype.removeByValue = function (a) { for (var b = 0; b < this.length; b++) if (this[b] == a) { this.splice(b, 1); break } } } }; function SingleModule() { } SingleModule.prototype = { price_num: function () { return new PriceNum }, seckill: function () { return new Seckill }, gifts: function () { return new Gifts }, productsnumdate: function () { return new productsNumDate }, addCart: function (a) { return new AddCart }, tree: function () { return new Tree }, listen: function () { return new Listen } };